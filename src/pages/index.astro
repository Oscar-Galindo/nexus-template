---
/**
 * Homepage - Black & White Minimalist Design
 * Digital operations without the mess.
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import MinimalistNav from '@/components/global/MinimalistNav.astro';
import MinimalistHero from '@/components/sections/MinimalistHero.astro';
import ProblemSection from '@/components/sections/ProblemSection.astro';
import SolutionSection from '@/components/sections/SolutionSection.astro';
import ResponsibilitySection from '@/components/sections/ResponsibilitySection.astro';
import ProcessSection from '@/components/sections/ProcessSection.astro';
import AboutSection from '@/components/sections/AboutSection.astro';
import DisqualificationSection from '@/components/sections/DisqualificationSection.astro';
import MinimalistFooter from '@/components/global/MinimalistFooter.astro';
import {
  getHomepageV2,
  getProblemCardsV2,
  getProcessStepsV2,
  getDisqualifiersV2,
  getAssetUrl,
} from '@/lib/contentful';

// Fetch content from Contentful
const [homepage, problemCards, processSteps, disqualifiers] = await Promise.all([
  getHomepageV2(),
  getProblemCardsV2(),
  getProcessStepsV2(),
  getDisqualifiersV2(),
]);

// Check if Contentful is configured
if (!homepage) {
  throw new Error('Contentful not configured or Homepage V2 entry not found. Please add CONTENTFUL_SPACE_ID and CONTENTFUL_ACCESS_TOKEN to .env');
}

// Hybrid image logic: URL first, then Asset fallback
const heroImageUrl = homepage.heroImageUrl || getAssetUrl(homepage.heroImage);
const aboutImageUrl = homepage.aboutImageUrl || getAssetUrl(homepage.aboutImage);
const logoUrl = homepage.logoUrl || getAssetUrl(homepage.logo);

// Validate required images
if (!heroImageUrl) {
  throw new Error('Hero image is required. Please add heroImageUrl or upload heroImage in Contentful.');
}
if (!aboutImageUrl) {
  throw new Error('About image is required. Please add aboutImageUrl or upload aboutImage in Contentful.');
}
if (!logoUrl) {
  throw new Error('Logo is required. Please add logoUrl or upload logo in Contentful.');
}

// SEO
const title = homepage.title;
const description = homepage.heroSubheadline;
---

<BaseLayout
  title={title}
  description={description}
>
  <!-- Navigation -->
  <MinimalistNav logoUrl={logoUrl} />

  <!-- Hero -->
  <MinimalistHero
    headline={homepage.heroHeadline}
    subheadline={homepage.heroSubheadline}
    targetAudience={homepage.heroTargetAudience}
    imageUrl={heroImageUrl}
    imageCaption={homepage.heroImageCaption}
  />

  <!-- Problem -->
  <ProblemSection
    title={homepage.problemSectionTitle}
    cards={problemCards}
  />

  <!-- Solution (Dark) -->
  <SolutionSection
    headline={homepage.solutionHeadline}
    headlineAccent={homepage.solutionHeadlineAccent}
    point1Title={homepage.solutionPoint1Title}
    point1Description={homepage.solutionPoint1Description}
    point2Title={homepage.solutionPoint2Title}
    point2Description={homepage.solutionPoint2Description}
    point3Title={homepage.solutionPoint3Title}
    point3Description={homepage.solutionPoint3Description}
  />

  <!-- Responsibility -->
  <ResponsibilitySection
    headline={homepage.responsibilityHeadline}
    subheadline={homepage.responsibilitySubheadline}
  />

  <!-- Process -->
  <ProcessSection
    headline={homepage.processHeadline}
    subheadline={homepage.processSubheadline}
    steps={processSteps}
    quote={homepage.processQuote}
  />

  <!-- About -->
  <AboutSection
    badge={homepage.aboutBadge}
    name={homepage.aboutName}
    title={homepage.aboutTitle}
    bioPrimary={homepage.aboutBioPrimary}
    bioSecondary={homepage.aboutBioSecondary}
    imageUrl={aboutImageUrl}
  />

  <!-- Disqualification -->
  <DisqualificationSection
    headline={homepage.disqualifierHeadline}
    disqualifiers={disqualifiers}
  />

  <!-- Footer CTA -->
  <MinimalistFooter
    headline={homepage.footerHeadline}
    subheadline={homepage.footerSubheadline}
    ctaText={homepage.footerCtaText}
    ctaLink={homepage.footerCtaLink}
    logoUrl={logoUrl}
  />
</BaseLayout>
